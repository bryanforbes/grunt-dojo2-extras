{"version":3,"file":"sync.js","sourceRoot":"","sources":["../../../src/commands/sync.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAAA,mCAA8B;IAC9B,8BAAgC;IAUhC,mBAAgC,GAAW,EAAE,GAAQ;;;;;4BAClC,qBAAM,GAAG,CAAC,SAAS,CAAC,mBAAmB,CAAC,EAAA;;oCAAxC,SAAwC;wBAC1D,EAAE,CAAC,CAAC,GAAG,KAAK,SAAS,CAAC,CAAC,CAAC;4BACvB,MAAM,IAAI,KAAK,CAAC,+BAA6B,SAAS,yCAAoC,GAAG,OAAI,CAAC,CAAC;wBACpG,CAAC;;;;;KACD;IALD,8BAKC;IAED,cAAmC,OAAgB;;gBAC1C,MAAM,EAAE,cAAc,EAAE,GAAG,EAC7B,GAAG;;;;iCAD+B,OAAO,0BAAP,OAAO,uBAAP,OAAO;8BACnC,IAAI,aAAG,CAAC,cAAc,CAAC;wBAEnC,YAAM,CAAC,IAAI,CAAC,aAAY,GAAG,YAAS,cAAiB,CAAC,CAAC;wBACvD,qBAAM,GAAG,CAAC,YAAY,CAAC,OAAO,CAAC,QAAQ,EAAE,OAAO,CAAC,SAAS,CAAC,EAAA;;wBAA3D,SAA2D,CAAC;6BACxD,GAAG,CAAC,aAAa,EAAE,EAAnB,wBAAmB;wBACtB,YAAM,CAAC,IAAI,CAAC,kCAAiC,cAAiB,CAAC,CAAC;wBAChE,qBAAM,SAAS,CAAC,GAAG,EAAE,GAAG,CAAC,EAAA;;wBAAzB,SAAyB,CAAC;;4BAG1B,qBAAM,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,EAAA;;wBAApB,SAAoB,CAAC;;4BAEtB,qBAAM,GAAG,CAAC,QAAQ,CAAC,MAAM,CAAC;6BACxB,IAAI,CACJ,cAAM,OAAA,GAAG,CAAC,IAAI,CAAC,QAAQ,EAAE,MAAM,CAAC,EAA1B,CAA0B,EAChC,cAAM,OAAA,GAAG,CAAC,YAAY,CAAC,MAAM,CAAC,EAAxB,CAAwB,CAC9B,EAAA;;wBAJF,SAIE,CAAC;;;;;KACH;IAlBD,uBAkBC","sourcesContent":["import Git from '../util/Git';\nimport { logger } from '../log';\n\nexport interface Options {\n\tbranch: string;\n\tcloneDirectory: string;\n\turl: string;\n\tusername?: string;\n\tuseremail?: string;\n}\n\nexport async function assertUrl(url: string, git: Git) {\n\tconst remoteUrl = await git.getConfig('remote.origin.url');\n\tif (url !== remoteUrl) {\n\t\tthrow new Error(`Existing repository url \"${ remoteUrl }\" is different from requested \"${ url }\"`);\n\t}\n}\n\nexport default async function sync(options: Options) {\n\tconst { branch, cloneDirectory, url } = options;\n\tconst git = new Git(cloneDirectory);\n\n\tlogger.info(`Syncing ${ url } to ${ cloneDirectory }`);\n\tawait git.ensureConfig(options.username, options.useremail);\n\tif (git.isInitialized()) {\n\t\tlogger.info(`Using existing repository at ${ cloneDirectory }`);\n\t\tawait assertUrl(url, git);\n\t}\n\telse {\n\t\tawait git.clone(url);\n\t}\n\tawait git.checkout(branch)\n\t\t.then(\n\t\t\t() => git.pull('origin', branch),\n\t\t\t() => git.createOrphan(branch)\n\t\t);\n}\n"]}