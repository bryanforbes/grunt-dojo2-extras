{"version":3,"file":"setup.js","sourceRoot":"","sources":["../../../../tests/unit/tasks/setup.ts"],"names":[],"mappings":"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","sourcesContent":["import * as registerSuite from 'intern!object';\nimport * as assert from 'intern/chai!assert';\nimport * as grunt from 'grunt';\nimport { stub, spy, SinonStub } from 'sinon';\nimport loadModule, { cleanupModuleMocks } from '../../_support/loadModule';\n\nlet setup: any;\nlet registerMultiTaskStub: SinonStub;\n\nconst authenticateStub = stub();\nconst getGithubSlugStub = stub();\nconst initDeploymentStub = stub();\nconst initAuthorizationStub = stub();\nconst wrapAsyncTaskStub = stub();\nconst optionsStub = stub();\nconst GitHub = class {\n\tconstructor() {\n\t\treturn this;\n\t}\n\tapi: any = {\n\t\tauthenticate: authenticateStub\n\t};\n};\nconst GitHubSpy = spy(GitHub);\n\nregisterSuite({\n\tname: 'tasks/setup',\n\n\tbeforeEach() {\n\t\tregisterMultiTaskStub = stub(grunt, 'registerMultiTask');\n\t\tsetup = loadModule('tasks/setup', {\n\t\t\t'./util/wrapAsyncTask': { default: wrapAsyncTaskStub },\n\t\t\t'../src/util/GitHub': { default: GitHubSpy },\n\t\t\t'./util/getGithubSlug': { default: getGithubSlugStub },\n\t\t\t'../src/commands/initialize/initDeployment': { default: initDeploymentStub },\n\t\t\t'../src/commands/initialize/initAuthorization': { default: initAuthorizationStub }\n\t\t});\n\t},\n\n\tafter() {\n\t\tcleanupModuleMocks();\n\t},\n\n\tafterEach() {\n\t\tgetGithubSlugStub.reset();\n\t\tauthenticateStub.reset();\n\t\tinitDeploymentStub.reset();\n\t\tinitAuthorizationStub.reset();\n\t\twrapAsyncTaskStub.reset();\n\t\toptionsStub.reset();\n\t\tGitHubSpy.reset();\n\n\t\tregisterMultiTaskStub.restore();\n\t},\n\n\t'setup calls initDeployment and initAuthorization; eventually resolves'(this: any) {\n\t\tconst deferred = this.async();\n\n\t\tlet counter = 0;\n\n\t\tgetGithubSlugStub.returns({ name: 'name', owner: 'owner' });\n\t\toptionsStub.returns({ password: 'password', username: 'username' });\n\t\twrapAsyncTaskStub.callsFake((task: () => Promise<any>) => {\n\t\t\ttask.call({ options: optionsStub }).then(deferred.rejectOnError(() => {\n\t\t\t\t// because wrapAsyncTask is called twice in this SUT, we don't want to run\n\t\t\t\t// any assertions until it has been called both times.\n\t\t\t\tif (counter >= 1) {\n\t\t\t\t\tassert.isTrue(optionsStub.calledTwice);\n\t\t\t\t\tassert.isTrue(registerMultiTaskStub.calledTwice);\n\t\t\t\t\tassert.isTrue(getGithubSlugStub.calledTwice);\n\t\t\t\t\tassert.isTrue(GitHubSpy.calledTwice);\n\t\t\t\t\tassert.isTrue(initDeploymentStub.calledOnce);\n\t\t\t\t\tassert.isTrue(initAuthorizationStub.calledOnce);\n\t\t\t\t\tdeferred.resolve();\n\t\t\t\t}\n\t\t\t\tcounter++;\n\t\t\t}));\n\t\t});\n\n\t\tsetup(grunt);\n\n\t\tassert.isTrue(wrapAsyncTaskStub.calledTwice);\n\t}\n});\n"]}