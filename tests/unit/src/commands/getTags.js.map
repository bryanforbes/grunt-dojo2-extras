{"version":3,"file":"getTags.js","sourceRoot":"","sources":["../../../../../tests/unit/src/commands/getTags.ts"],"names":[],"mappings":"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","sourcesContent":["import * as registerSuite from 'intern!object';\nimport * as assert from 'intern/chai!assert';\nimport * as path from 'path';\nimport loadModule, { cleanupModuleMocks } from '../../../_support/loadModule';\nimport { stub, SinonStub } from 'sinon';\nimport { getHtmlApiPath, getJsonApiPath } from '../../../../src/commands/getTags';\nimport { Tag } from '../../../../src/util/GitHub';\n\nlet module: any;\nlet existsSyncStub: SinonStub;\n\nfunction assertExistsFilter(builder: any, expected: boolean, filename: string) {\n\tconst filter = builder('project', 'directory');\n\texistsSyncStub.returns(expected);\n\tassert.strictEqual(filter({ name: 'version' }), !expected);\n\tassert.isTrue(existsSyncStub.called, 'existSync was not called');\n\tassert.strictEqual(existsSyncStub.firstCall.args[0], filename);\n}\n\nregisterSuite({\n\tname: 'getTags',\n\n\tbefore() {\n\t\texistsSyncStub = stub();\n\t},\n\n\tafter() {\n\t\tcleanupModuleMocks();\n\t},\n\n\tbeforeEach() {\n\t\tmodule = loadModule('src/commands/getTags', {\n\t\t\tfs: {\n\t\t\t\texistsSync: existsSyncStub\n\t\t\t}\n\t\t}, false);\n\t},\n\n\tafterEach() {\n\t\texistsSyncStub.reset();\n\t},\n\n\tgetHtmlApiPath() {\n\t\tassert.strictEqual(getHtmlApiPath('base', 'project', 'version'), path.join('base', 'project', 'version'));\n\t},\n\n\tgetJsonApiPath() {\n\t\tassert.strictEqual(getJsonApiPath('base', 'project', 'version'), path.join('base', 'project-version.json'));\n\t},\n\n\tfilters: {\n\t\tcreateHtmlApiMissingFilter: {\n\t\t\t'exists; returns false'() {\n\t\t\t\tconst { createHtmlApiMissingFilter } = module;\n\t\t\t\tassertExistsFilter(createHtmlApiMissingFilter, true, path.join('directory', 'project', 'version'));\n\t\t\t},\n\n\t\t\t'does not exist; returns true'() {\n\t\t\t\tconst { createHtmlApiMissingFilter } = module;\n\t\t\t\tassertExistsFilter(createHtmlApiMissingFilter, false, path.join('directory', 'project', 'version'));\n\t\t\t}\n\t\t},\n\n\t\tcreateJsonApiMissingFilter: {\n\t\t\t'exists; returns false'() {\n\t\t\t\tconst { createJsonApiMissingFilter } = module;\n\t\t\t\tassertExistsFilter(createJsonApiMissingFilter, true, path.join('directory', 'project-version.json'));\n\t\t\t},\n\n\t\t\t'does not exist; returns true'() {\n\t\t\t\tconst { createJsonApiMissingFilter } = module;\n\t\t\t\tassertExistsFilter(createJsonApiMissingFilter, false, path.join('directory', 'project-version.json'));\n\t\t\t}\n\t\t},\n\n\t\tlatestFilter() {\n\t\t\tconst { latestFilter } = module;\n\t\t\tconst list = [ 'one', 'two', 'three' ];\n\t\t\tassert.deepEqual(list.filter(latestFilter), [ 'three' ]);\n\t\t},\n\n\t\tcreateVersionFilter: {\n\t\t\t'satisfies semver; returns true'() {\n\t\t\t\tconst { createVersionFilter } = module;\n\t\t\t\tconst filter = createVersionFilter('>= 2.0.0');\n\t\t\t\tassert.isTrue(filter({ name: '2.0.0' }));\n\t\t\t},\n\n\t\t\t'does not satisfy semver; returns false'() {\n\t\t\t\tconst { createVersionFilter } = module;\n\t\t\t\tconst filter = createVersionFilter('< 2.0.0');\n\t\t\t\tassert.isFalse(filter({ name: '2.0.0' }));\n\t\t\t}\n\t\t}\n\t},\n\n\tgetTags: (() => {\n\t\tlet getTags: any;\n\t\tlet mockGitHub: any;\n\n\t\treturn {\n\t\t\tbefore() {\n\t\t\t\tgetTags = module.default;\n\t\t\t\tmockGitHub = {\n\t\t\t\t\tfetchTags() {\n\t\t\t\t\t\treturn Promise.resolve([\n\t\t\t\t\t\t\t{ name: 'one' },\n\t\t\t\t\t\t\t{ name: '2.0.0' },\n\t\t\t\t\t\t\t{ name: '1.6.5' },\n\t\t\t\t\t\t\t{ name: '3.0.0-beta' }\n\t\t\t\t\t\t]);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t},\n\n\t\t\tasync 'removes version not compatible with semver'() {\n\t\t\t\tconst tags = await getTags(mockGitHub);\n\t\t\t\tconst expected = [\n\t\t\t\t\t{ name: '1.6.5' },\n\t\t\t\t\t{ name: '2.0.0' },\n\t\t\t\t\t{ name: '3.0.0-beta' }\n\t\t\t\t];\n\t\t\t\tassert.deepEqual(tags, expected);\n\t\t\t},\n\n\t\t\tasync 'applies filters'() {\n\t\t\t\tconst filter = (tag: Tag) => {\n\t\t\t\t\treturn tag.name === '2.0.0';\n\t\t\t\t};\n\t\t\t\tconst tags = await getTags(mockGitHub, [ filter ]);\n\t\t\t\tconst expected = [\n\t\t\t\t\t{ name: '2.0.0' }\n\t\t\t\t];\n\t\t\t\tassert.deepEqual(tags, expected);\n\t\t\t}\n\t\t};\n\t})()\n});\n"]}